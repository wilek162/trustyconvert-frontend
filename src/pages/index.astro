---
// src/pages/index.astro
import { Check, Lock, Zap } from '@lucide/astro'

import FileConverter from '@/components/features/FileConverter'
import type { ConversionFormat } from '@/lib/api/types'
import { mockFormats } from '@/mocks/data'

import QueryProvider from '@/components/providers/QueryProvider'
import MainLayout from '@/layouts/MainLayout.astro'
import { Hero } from '@/components/Hero'
import { Features } from '@/components/Features'

const title = 'TrustyConvert - Fast & Secure File Conversion'
const description =
	'Convert your files with lightning speed and professional-grade security. No tracking, no storage - your privacy comes first.'
const canonical = new URL('/', Astro.site).toString()
// Enhanced structured data for better SEO
const structuredData = {
	'@context': 'https://schema.org',
	'@type': 'WebApplication',
	name: 'TrustyConvert',
	url: canonical,
	description: description,
	applicationCategory: 'UtilityApplication',
	operatingSystem: 'Any',
	offers: {
		'@type': 'Offer',
		price: '0',
		priceCurrency: 'USD',
		availability: 'https://schema.org/InStock'
	},
	featureList: [
		'Fast file conversion',
		'Secure processing',
		'Privacy focused',
		'Multiple file formats'
	],
	aggregateRating: {
		'@type': 'AggregateRating',
		ratingValue: '4.8',
		ratingCount: '1250',
		bestRating: '5',
		worstRating: '1'
	},
	provider: {
		'@type': 'Organization',
		name: 'TrustyConvert',
		url: canonical
	},
	browserRequirements: 'Requires JavaScript. Requires HTML5.',
	permissions: 'File upload required',
	softwareVersion: '1.0.0'
}

// Fetch supported formats for the dropdown
let formats: ConversionFormat[] = []

if (import.meta.env.DEV) {
	// Use mock data in development
	formats = mockFormats
} else {
	try {
		const response = await fetch(
			`${import.meta.env.PUBLIC_API_URL || '/api'}/supported-conversions`,
			{
				headers: {
					Accept: 'application/json'
				}
			}
		)
		const data = await response.json()
		formats = data.data
	} catch (error) {
		console.error('Failed to fetch formats:', error)
		// Fallback to mock data if fetch fails
		formats = mockFormats
	}
}

// Generate alternate language links
const alternateLanguages = [
	{ code: 'en', name: 'English' },
	{ code: 'es', name: 'Español' },
	{ code: 'fr', name: 'Français' },
	{ code: 'de', name: 'Deutsch' }
]
---

<MainLayout
	title={title}
	description={description}
	canonical={canonical}
	extraStructuredData={structuredData}
	alternateLanguages={alternateLanguages}
>
	<Hero client:load onFileConvert={(file, format) => console.log(file, format)} />

	<Features />

	<section class="trusty-section bg-lightGray">
		<div class="trusty-container">
			<div class="mb-12 text-center">
				<h2 class="mb-4">How It Works</h2>
				<p class="mx-auto max-w-2xl text-lg text-muted-foreground">
					TrustyConvert makes file conversion simple, secure, and lightning-fast in just three easy
					steps.
				</p>
			</div>

			<div class="grid grid-cols-1 gap-8 md:grid-cols-3">
				<div class="trusty-card text-center">
					<div
						class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-trustTeal/10"
					>
						<span class="text-2xl font-semibold text-trustTeal">1</span>
					</div>
					<h3 class="mb-2 text-xl font-medium">Upload Your File</h3>
					<p class="text-muted-foreground">
						Drag and drop or browse to select the file you want to convert.
					</p>
				</div>

				<div class="trusty-card text-center">
					<div
						class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-trustTeal/10"
					>
						<span class="text-2xl font-semibold text-trustTeal">2</span>
					</div>
					<h3 class="mb-2 text-xl font-medium">Choose Target Format</h3>
					<p class="text-muted-foreground">
						Select the format you want to convert your file to from our wide range of options.
					</p>
				</div>

				<div class="trusty-card text-center">
					<div
						class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-trustTeal/10"
					>
						<span class="text-2xl font-semibold text-trustTeal">3</span>
					</div>
					<h3 class="mb-2 text-xl font-medium">Download Converted File</h3>
					<p class="text-muted-foreground">
						Your file is converted instantly and ready for download. No registration required.
					</p>
				</div>
			</div>
		</div>
	</section>

	<section class="trusty-section bg-deepNavy text-white">
		<div class="trusty-container">
			<div class="flex flex-col items-center justify-between gap-8 md:flex-row">
				<div class="max-w-xl">
					<h2 class="mb-4">Ready to Convert Your Files?</h2>
					<p class="mb-6 text-gray-300">
						Experience lightning-fast file conversion with professional-grade security. No
						registration required.
					</p>
					<a href="/" class="btn btn-primary">Convert Now</a>
				</div>

				<div class="rounded-card border border-trustTeal/20 bg-deepNavy/50 p-6">
					<div class="flex flex-col gap-4">
						<div class="flex items-center gap-3">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="text-trustTeal"
							>
								<path d="m9 12 2 2 4-4"></path>
								<path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"
								></path>
							</svg>
							<span>No registration required</span>
						</div>
						<div class="flex items-center gap-3">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="text-trustTeal"
							>
								<path d="m9 12 2 2 4-4"></path>
								<path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"
								></path>
							</svg>
							<span>Files deleted after conversion</span>
						</div>
						<div class="flex items-center gap-3">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="text-trustTeal"
							>
								<path d="m9 12 2 2 4-4"></path>
								<path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"
								></path>
							</svg>
							<span>Bank-level encryption</span>
						</div>
						<div class="flex items-center gap-3">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="text-trustTeal"
							>
								<path d="m9 12 2 2 4-4"></path>
								<path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"
								></path>
							</svg>
							<span>Unlimited conversions</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</MainLayout>

<style is:global>
	/* Add loading state styles */
	.file-upload-loading {
		opacity: 0;
		animation: fadeIn 0.3s ease-in forwards;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}
</style>
