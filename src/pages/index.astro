---
// src/pages/index.astro
import { Check, Lock, Zap } from '@lucide/astro'

import { ConversionFlow } from '@/components/features/conversion'
import type { ConversionFormat } from '@/lib/types/api'
import { mockFormats } from '@/mocks/data'

import { AppProviders } from '@/components/providers/AppProviders'
import MainLayout from '@/layouts/MainLayout.astro'
import { Hero } from '@/components/Hero'
import { Features } from '@/components/Features'
import { CallToAction } from '@/components/CallToAction'
import { Testimonials } from '@/components/Testimonials'

const title = 'TrustyConvert - Fast & Secure File Conversion'
const description =
	'Convert your files with lightning speed and professional-grade security. No tracking, no storage - your privacy comes first.'
const canonical = new URL('/', Astro.site).toString()
// Enhanced structured data for better SEO
const structuredData = {
	'@context': 'https://schema.org',
	'@type': 'WebApplication',
	name: 'TrustyConvert',
	url: canonical,
	description: description,
	applicationCategory: 'UtilityApplication',
	operatingSystem: 'Any',
	offers: [
		{
			'@type': 'Offer',
			price: '0',
			priceCurrency: 'USD',
			availability: 'https://schema.org/InStock'
		}
	],
	featureList: [
		'Fast file conversion',
		'Secure processing',
		'Privacy focused',
		'Multiple file formats'
	],
	aggregateRating: {
		'@type': 'AggregateRating',
		ratingValue: '4.8',
		ratingCount: '1250',
		bestRating: '5',
		worstRating: '1'
	},
	provider: {
		'@type': 'Organization',
		name: 'TrustyConvert',
		url: canonical
	},
	browserRequirements: 'Requires JavaScript. Requires HTML5.',
	permissions: 'File upload required',
	softwareVersion: '1.0.0'
}

// Fetch supported formats for the dropdown
let formats: ConversionFormat[] = []

if (import.meta.env.DEV) {
	// Use mock data in development with appropriate type conversion
	formats = mockFormats.map((mock) => ({
		id: mock.id,
		name: mock.name,
		description: mock.name, // Use name as description
		input_formats: mock.inputFormats,
		output_formats: mock.outputFormats,
		icon: mock.icon
	}))
} else {
	try {
		const response = await fetch(
			`${import.meta.env.PUBLIC_API_URL || '/api'}/supported-conversions`,
			{
				headers: {
					Accept: 'application/json'
				}
			}
		)
		const data = await response.json()
		formats = data.data
	} catch (error) {
		console.error('Failed to fetch formats:', error)
		// Fallback to mock data if fetch fails with appropriate type conversion
		formats = mockFormats.map((mock) => ({
			id: mock.id,
			name: mock.name,
			description: mock.name, // Use name as description
			input_formats: mock.inputFormats,
			output_formats: mock.outputFormats,
			icon: mock.icon
		}))
	}
}

// Generate alternate language links
const alternateLanguages = [
	{ code: 'en', name: 'English' },
	{ code: 'es', name: 'Español' },
	{ code: 'fr', name: 'Français' },
	{ code: 'de', name: 'Deutsch' }
]
---

<MainLayout
	title={title}
	description={description}
	canonical={canonical}
	extraStructuredData={structuredData}
	alternateLanguages={alternateLanguages}
>
	<Hero client:load />

	<section class="trusty-section bg-white">
		<div class="trusty-container">
			<div class="mb-12 text-center">
				<h2 class="mb-4">Convert Your Files Now</h2>
				<p class="mx-auto max-w-2xl text-lg text-muted-foreground">
					Fast, secure file conversion with no registration required. Your files are processed
					locally and never stored.
				</p>
			</div>

			<AppProviders enableDevtools={import.meta.env.DEV}>
				<ConversionFlow client:load />
			</AppProviders>
		</div>
	</section>

	<Features />

	<section class="trusty-section bg-lightGray">
		<div class="trusty-container">
			<div class="mb-12 text-center">
				<h2 class="mb-4">How It Works</h2>
				<p class="mx-auto max-w-2xl text-lg text-muted-foreground">
					TrustyConvert makes file conversion simple, secure, and lightning-fast in just three easy
					steps.
				</p>
			</div>

			<div class="grid grid-cols-1 gap-8 md:grid-cols-3">
				<div class="trusty-card text-center">
					<div
						class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-trustTeal/10"
					>
						<span class="text-2xl font-semibold text-trustTeal">1</span>
					</div>
					<h3 class="mb-2 text-xl font-medium">Upload Your File</h3>
					<p class="text-muted-foreground">
						Drag and drop or browse to select the file you want to convert.
					</p>
				</div>

				<div class="trusty-card text-center">
					<div
						class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-trustTeal/10"
					>
						<span class="text-2xl font-semibold text-trustTeal">2</span>
					</div>
					<h3 class="mb-2 text-xl font-medium">Choose Target Format</h3>
					<p class="text-muted-foreground">
						Select the format you want to convert your file to from our wide range of options.
					</p>
				</div>

				<div class="trusty-card text-center">
					<div
						class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-trustTeal/10"
					>
						<span class="text-2xl font-semibold text-trustTeal">3</span>
					</div>
					<h3 class="mb-2 text-xl font-medium">Download Converted File</h3>
					<p class="text-muted-foreground">
						Your file is converted instantly and ready for download. No registration required.
					</p>
				</div>
			</div>
		</div>
	</section>

	<Testimonials client:visible />

	<CallToAction client:visible />
</MainLayout>

<style is:global>
	/* Add loading state styles */
	.file-upload-loading {
		opacity: 0.7;
		pointer-events: none;
	}

	/* Custom card styling */
	.trusty-card {
		@apply rounded-xl border border-gray-200 bg-white p-6 shadow-sm transition-all duration-300 hover:shadow-md;
	}

	/* Section styling */
	.trusty-section {
		@apply py-16 md:py-24;
	}

	.trusty-container {
		@apply mx-auto max-w-7xl px-4 sm:px-6 lg:px-8;
	}

	/* Feature grid styling */
	.features-grid {
		@apply grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3;
	}

	/* Button styling */
	.btn {
		@apply inline-flex items-center justify-center rounded-md px-6 py-3 text-base font-medium transition-all duration-200;
	}

	.btn-primary {
		@apply bg-trustTeal text-white hover:bg-trustTeal/90;
	}

	.btn-outline {
		@apply border border-white text-white hover:bg-white/10;
	}

	/* Testimonial styling */
	.testimonial-card {
		@apply rounded-xl bg-white p-6 shadow-sm;
	}
</style>
