---
import MultilingualLayout from '@/layouts/MultilingualLayout.astro'
import { Hero } from '@/components/Hero'
import { Features } from '@/components/Features'
import { HowItWorks } from '@/components/HowItWorks'
import { SupportedFormats } from '@/components/SupportedFormats'
import { Testimonials } from '@/components/Testimonials'
import { FAQ } from '@/components/FAQ'
import { LANGUAGES, DEFAULT_LANGUAGE } from '@/lib/i18n/config'
import { t } from '@/lib/i18n/translations'
import { generateLanguagePaths } from '@/lib/i18n/utils'

// Get language from URL parameter
export function getStaticPaths() {
	return generateLanguagePaths()
}

const { lang } = Astro.params

// Create structured data for SEO
const structuredData = {
	'@context': 'https://schema.org',
	'@type': 'WebApplication',
	name: 'TrustyConvert',
	description: t('site_description', lang as string),
	applicationCategory: 'UtilityApplication',
	operatingSystem: 'All',
	offers: {
		'@type': 'Offer',
		price: '0',
		priceCurrency: 'USD'
	}
}

// Get formats data (from API or fallback to mock)
let formats = []
if (import.meta.env.SSR) {
	try {
		const response = await fetch(
			`${import.meta.env.PUBLIC_API_URL || '/api'}/supported-conversions`,
			{
				headers: {
					Accept: 'application/json'
				}
			}
		)
		const data = await response.json()
		formats = data.data
	} catch (error) {
		console.error('Failed to fetch formats:', error)
	}
}
---

<MultilingualLayout
	extraStructuredData={structuredData}
	lang={lang as string}
>
	<div class="bg-gradient-to-b from-white to-lightGray/20">
		<div id="convert" class="scroll-mt-24">
			<Hero client:load />
		</div>

		<HowItWorks />
	</div>

	<Features />

	<SupportedFormats />

	<Testimonials />

	<FAQ />
</MultilingualLayout>
