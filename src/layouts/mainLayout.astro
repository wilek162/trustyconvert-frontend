---
import '@/styles/global.css'
// Import the app initialization
import { initializeApp, initializeBrowser } from '@/lib/app'
// Import fonts
import '@fontsource-variable/inter'
import '@fontsource/poppins/400.css'
import '@fontsource/poppins/500.css'
import '@fontsource/poppins/600.css'
import '@fontsource/poppins/700.css'
import { AppProviders } from '@/components/providers/AppProviders'
import { CloseSession } from '@/components/features/session'
// import { OfflineBanner } from '@/components/ui/offlineBanner'

// Define a type for structured data to avoid using 'any'
type StructuredData = {
	'@context': string
	'@type': string
	[key: string]:
		| string
		| number
		| boolean
		| null
		| undefined
		| StructuredData
		| Array<string | number | StructuredData>
}

interface Props {
	title: string
	description: string
	image?: string
	canonical?: string
	ogImage?: string
	noindex?: boolean
	extraStructuredData?: StructuredData
	alternateLanguages?: { code: string; name: string }[]
}

// Compute the app version for cache busting
const appVersion = import.meta.env.PUBLIC_APP_VERSION || '0.0.1'

// Initialize the application
initializeApp()

// No longer needed - using Props interface instead

// Default SEO values
const {
	title = 'TrustyConvert - Fast & Secure File Conversion',
	description = 'Convert files quickly and securely with TrustyConvert. No registration required, your privacy guaranteed.',
	canonical = Astro.url.href,
	ogImage = '/og-image.png',
	noindex = false,
	alternateLanguages = [],
	extraStructuredData = null
} = Astro.props

// Initialize browser features
initializeBrowser()
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />

		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="application-version" content={appVersion} />

		<!-- Canonical URL -->
		{canonical && <link rel="canonical" href={canonical} />}

		<!-- Alternate language links -->
		{
			alternateLanguages &&
				alternateLanguages.map((lang) => (
					<link
						rel="alternate"
						hreflang={lang.code}
						href={`${Astro.url.origin}/${lang.code !== 'en' ? lang.code : ''}`}
					/>
				))
		}

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonical || Astro.url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={ogImage} />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta property="twitter:url" content={canonical || Astro.url} />
		<meta property="twitter:title" content={title} />
		<meta property="twitter:description" content={description} />
		<meta property="twitter:image" content={ogImage} />

		<!-- Structured Data -->
		{
			extraStructuredData && (
				<script type="application/ld+json" set:html={JSON.stringify(extraStructuredData)} />
			)
		}

		<!-- Preconnect to API -->
		<link rel="preconnect" href="/api" />

		<!-- Preload critical assets -->
		<link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
	</head>
	<body class="min-h-screen bg-background font-sans antialiased">
		<!-- Offline status banner -->
		<!-- <OfflineBanner client:load /> -->

		<header
			class="sticky top-0 z-50 border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"
		>
			<div class="trusty-container flex h-24 items-center justify-between">
				<div class="flex items-center gap-6">
					<a href="/" class="group flex items-center space-x-3">
						<div
							class="relative h-20 w-20 overflow-hidden rounded-lg bg-trustTeal/10 p-0.5 transition-all group-hover:bg-trustTeal/20 group-hover:shadow-sm"
						>
							<img
								src="/logo-no-bg.svg"
								alt="TrustyConvert Logo"
								class="h-full w-full object-contain transition-transform group-hover:scale-105"
							/>
						</div>
						<span
							class="text-2xl font-bold text-foreground transition-all group-hover:text-trustTeal"
							>TrustyConvert</span
						>
					</a>
					<nav class="hidden md:flex">
						<ul class="flex items-center gap-8">
							<li>
								<a
									href="/"
									class={`text-sm font-medium transition-colors hover:text-foreground ${Astro.url.pathname === '/' ? 'text-foreground' : 'text-muted-foreground'}`}
								>
									Home
								</a>
							</li>
							<li>
								<a
									href="/all-conversions"
									class={`text-sm font-medium transition-colors hover:text-foreground ${Astro.url.pathname === '/all-conversions' ? 'text-foreground' : 'text-muted-foreground'}`}
								>
									All Conversions
								</a>
							</li>
							<li>
								<a
									href="/blog"
									class={`text-sm font-medium transition-colors hover:text-foreground ${Astro.url.pathname.startsWith('/blog') ? 'text-foreground' : 'text-muted-foreground'}`}
								>
									Blog
								</a>
							</li>
							<li>
								<a
									href="/about"
									class={`text-sm font-medium transition-colors hover:text-foreground ${Astro.url.pathname === '/about' ? 'text-foreground' : 'text-muted-foreground'}`}
								>
									About
								</a>
							</li>
							<li>
								<a
									href="/privacy"
									class={`text-sm font-medium transition-colors hover:text-foreground ${Astro.url.pathname === '/privacy' ? 'text-foreground' : 'text-muted-foreground'}`}
								>
									Privacy
								</a>
							</li>
						</ul>
					</nav>
				</div>
				<div class="flex items-center gap-4">
					<a
						href="/"
						class="hidden items-center rounded-button bg-trustTeal px-6 py-3 text-sm font-medium text-white transition-all hover:bg-trustTeal/90 hover:shadow-md md:inline-flex"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="16"
							height="16"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="mr-2"
						>
							<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
							<polyline points="17 8 12 3 7 8"></polyline>
							<line x1="12" y1="3" x2="12" y2="15"></line>
						</svg>
						Convert Files
					</a>
					<button
						class="flex h-10 w-10 items-center justify-center rounded-button bg-muted md:hidden"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
						>
							<line x1="4" x2="20" y1="12" y2="12"></line>
							<line x1="4" x2="20" y1="6" y2="6"></line>
							<line x1="4" x2="20" y1="18" y2="18"></line>
						</svg>
					</button>
				</div>
			</div>
		</header>

		<main class="flex-1">
			<AppProviders client:load>
				<slot />
			</AppProviders>
		</main>

		<footer class="border-t border-border bg-deepNavy text-white">
			<div class="trusty-container py-12 md:py-16">
				<div class="grid grid-cols-1 gap-10 md:grid-cols-3">
					<div>
						<a href="/" class="group flex items-center space-x-3">
							<div
								class="h-14 w-14 overflow-hidden rounded-lg bg-white/10 p-0.5 transition-all group-hover:bg-white/20 group-hover:shadow-sm"
							>
								<img
									src="/logo-no-bg.svg"
									alt="TrustyConvert Logo"
									class="h-full w-full object-contain transition-transform group-hover:scale-105"
								/>
							</div>
							<span class="text-2xl font-bold transition-all group-hover:text-trustTeal"
								>TrustyConvert</span
							>
						</a>
						<p class="mt-3 text-sm text-white/70">
							Fast, secure file conversion with privacy guaranteed.
						</p>
						<div class="mt-6 flex items-center space-x-4">
							<a
								href="#"
								class="flex h-8 w-8 items-center justify-center rounded-button bg-white/10 text-white/60 transition-colors hover:bg-white/20 hover:text-white"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="16"
									height="16"
									fill="currentColor"
									viewBox="0 0 24 24"
								>
									<path
										d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"
									></path>
								</svg>
							</a>
							<a
								href="#"
								class="flex h-8 w-8 items-center justify-center rounded-button bg-white/10 text-white/60 transition-colors hover:bg-white/20 hover:text-white"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="16"
									height="16"
									fill="currentColor"
									viewBox="0 0 24 24"
								>
									<path
										d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
									></path>
								</svg>
							</a>
							<a
								href="#"
								class="flex h-8 w-8 items-center justify-center rounded-button bg-white/10 text-white/60 transition-colors hover:bg-white/20 hover:text-white"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="16"
									height="16"
									fill="currentColor"
									viewBox="0 0 24 24"
								>
									<path
										d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"
									></path>
								</svg>
							</a>
						</div>
					</div>
					<div class="grid grid-cols-2 gap-8 md:col-span-2">
						<div>
							<h3 class="text-sm font-medium text-white">Resources</h3>
							<ul class="mt-4 space-y-3 text-sm">
								<li>
									<a href="/blog" class="text-white/70 transition-colors hover:text-white">
										Blog
									</a>
								</li>
								<li>
									<a href="/about" class="text-white/70 transition-colors hover:text-white">
										About Us
									</a>
								</li>
								<li>
									<a href="/privacy" class="text-white/70 transition-colors hover:text-white">
										Privacy Policy
									</a>
								</li>
								<li>
									<a href="/faq" class="text-white/70 transition-colors hover:text-white"> FAQ </a>
								</li>
								<li>
									<a
										href="/rss.xml"
										class="flex items-center text-white/70 transition-colors hover:text-white"
									>
										<svg
											xmlns="http://www.w3.org/2000/svg"
											width="16"
											height="16"
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="mr-2"
										>
											<path d="M4 11a9 9 0 0 1 9 9"></path>
											<path d="M4 4a16 16 0 0 1 16 16"></path>
											<circle cx="5" cy="19" r="1"></circle>
										</svg>
										RSS Feed
									</a>
								</li>
							</ul>
						</div>
						<div>
							<h3 class="text-sm font-medium text-white">Contact</h3>
							<ul class="mt-4 space-y-3 text-sm">
								<li>
									<a
										href="mailto:support@trustyconvert.com"
										class="flex items-center text-white/70 transition-colors hover:text-white"
									>
										<svg
											xmlns="http://www.w3.org/2000/svg"
											width="16"
											height="16"
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="mr-2"
										>
											<path
												d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
											></path>
											<polyline points="22,6 12,13 2,6"></polyline>
										</svg>
										support@trustyconvert.com
									</a>
								</li>
							</ul>
						</div>
					</div>
				</div>

				{/* Wave separator */}
				<div class="relative mt-12 pt-8">
					<div class="absolute inset-0 flex items-center" aria-hidden="true">
						<div class="w-full border-t border-white/10"></div>
					</div>
				</div>

				<div class="mt-4 text-center">
					<p class="text-xs text-white/50">
						&copy; {new Date().getFullYear()} TrustyConvert. All rights reserved.
						<span class="ml-4 inline-block">
							<CloseSession variant="minimal" client:load />
						</span>
					</p>
				</div>
			</div>
		</footer>
	</body>
</html>
